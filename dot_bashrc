alias l='lsd -l'
alias d=dotnet
alias cc=claude
alias oc='safe_tui opencode'
alias co='copilot'
alias oce='OPENCODE_EXPERIMENTAL_PLAN_MODE=1 safe_tui opencode'
alias ocm='bunx opencode-marketplace'
alias ccsp='claude --dangerously-skip-permissions'
alias c=code
alias bashrc='code ~/.bashrc'
alias tm='task-master'
alias lg='lazygit'
alias ld='lazydocker'
alias lc='uvx lazyclaude'
alias loc='uvx lazyopencode'
alias g='git'
alias docker='podman'
alias cz='chezmoi'
alias vault='start obsidian://open?vault=notes'
alias cck='npx claude-code-kanban --open'

alias ??='opencode run --model google/gemini-3-flash-preview'
alias ???='opencode run --model google/gemini-3-flash-preview --continue'

#####
# config
#####

# XDG Base Directory Specification, required for nvim
export XDG_CONFIG_HOME="$HOME/.config"

export MSYS=winsymlinks:nativestrict

######
# terminal
######
alias wtc='wt -w 0 -d $(pwd) --title "$(basename $(pwd))"'

ac() {
    local dir="${1:-$(pwd)}"
    alacritty --working-directory "$dir" &
}

#update_terminal_title
utt() {
    echo -ne "\033]0;$(basename "$PWD")\007"
}

## well known issue with alacritty and mouse mode
safe_tui() {
    "$@"
    printf '\e[?1000l\e[?1002l\e[?1003l\e[?1006l'
}

fix_mouse() {
    printf '\e[?1000l\e[?1002l\e[?1003l\e[?1006l'
}


# Tmux Smart Attach/Create Function
# Usage: t [folder] - attach/create tmux session named after folder (default: current dir)
t() {
  local target_dir="${1:-$PWD}"
  local session_name=$(basename "$target_dir" | tr . _)

  if tmux has-session -t "$session_name" 2>/dev/null; then
    if [ -n "$TMUX" ]; then
      tmux switch-client -t "$session_name"
    else
      tmux attach-session -t "$session_name"
    fi
  else
    if [ -n "$TMUX" ]; then
      tmux new-session -d -s "$session_name" -c "$target_dir"
      tmux switch-client -t "$session_name"
    else
      tmux new-session -s "$session_name" -c "$target_dir"
    fi
  fi
}

######
# editor
######
export EDITOR="code --wait"
export VISUAL="code --wait"

#####
# z
#####
if [[ "$-" == *i* ]]; then
    eval "$(zoxide init bash)"
fi

######
# git
######
if [[ "$-" = *i* ]]; then
    if [ -f ~/.bashrc_git ]; then
        source ~/.bashrc_git
    fi
fi

######
# fzf
######
# https://github.com/junegunn/fzf
if [[ "$-" == *i* ]]; then
    eval "$(fzf --bash)"
fi

# Preview file content using bat (https://github.com/sharkdp/bat)
export FZF_CTRL_T_OPTS="
    --walker-skip .git,node_modules,target,bin,obj
    --preview 'bat -n --color=always {}'
    --preview-window=right,80%
    --height 90%
    --bind 'ctrl-/:change-preview-window(down|)'"

# CTRL-Y to copy the command into clipboard using pbcopy
export FZF_CTRL_R_OPTS=" 
    --bind 'ctrl-y:execute-silent(echo -n {2..} | clip)+abort'
    --color header:italic
    --header 'Press CTRL-Y to copy command into clipboard'"

# Print tree structure in the preview window
export FZF_ALT_C_OPTS="--walker-skip .git,node_modules,target,bin,obj"

export FZF_DEFAULT_COMMAND='fd --type f --strip-cwd-prefix'

function fzfp() {
    local PROJECTS=$(dotnet sln list | sed '1,2d')
    echo "$PROJECTS" | fzf --preview "bat --style=numbers --color=always --line-range :500 {} -l xml"
}

alias fzfd='fd --type d --strip-cwd-prefix | fzf'

rfzf() {
    fzf --disabled --ansi --query "$*" \
        --height 90% \
        --layout reverse \
        --preview-window 'down,80%,border-top,+{2}-5' \
        --delimiter : \
        --bind "start:reload:rg --column --line-number --no-heading --color=always --smart-case -- {q} || true" \
        --bind "change:reload:rg --column --line-number --no-heading --color=always --smart-case -- {q} || true" \
        --preview 'bat --style=numbers --color=always --highlight-line {2} {1}' \
        --bind 'ctrl-/:change-preview-window(right,60%|down,80%|hidden)' \
        --bind "ctrl-y:execute-silent(echo -n {1}:{2} | clip)" \
    | cut -d: -f1
}

cwt() {
  local dir=$(g wtl | fzf | awk '{print $1}')
  [[ -n "$dir" ]] && cd "$dir"
}

######
# history
######
shopt -s histappend
HISTSIZE=5000
HISTFILESIZE=10000
HISTCONTROL=ignoreboth:erasedups
HISTIGNORE="ls:ll:l:cd:pwd:exit:clear"
PROMPT_COMMAND="history -a;history -c;history -r;$PROMPT_COMMAND"

######
# oh-my-posh
######
# https://ohmyposh.dev/docs/
if [[ "$-" = *i* ]]; then
    eval "$(oh-my-posh init bash --config ~/.nikiforovall.omp3.json)"
fi

######
# worktrunk
######

# alias (gwt -> dynamic wt.exe to avoid Windows Terminal conflict)
if command -v git-wt.exe &> /dev/null; then
    alias gwt="git-wt.exe"
fi

# Claude Code deferred MCP loading (added by Taskmaster)
export ENABLE_EXPERIMENTAL_MCP_CLI='true'

# Set terminal title to current directory on load
[[ "$-" = *i* ]] && echo -ne "\033]0;$(basename "$PWD")\007"
